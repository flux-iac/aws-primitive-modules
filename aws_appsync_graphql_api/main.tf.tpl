######################################################################
# Generated by Tofu-Jet. Please do not manually edit.
# AWS Primitive Module for TF-controller
# Resource: aws_appsync_graphql_api
######################################################################

terraform {
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "4.38.0"
    }
  }
}

provider "aws" {
}

variable "values" {
  type = object({
    additional_authentication_provider = optional(list(object({
        authentication_type = optional(string)
        openid_connect_config = optional(list(object({
            iat_ttl = optional(number)
            issuer = optional(string)
            auth_ttl = optional(number)
            client_id = optional(string)
        })))
        user_pool_config = optional(list(object({
            app_id_client_regex = optional(string)
            aws_region = optional(string)
            user_pool_id = optional(string)
        })))
        lambda_authorizer_config = optional(list(object({
            authorizer_result_ttl_in_seconds = optional(number)
            authorizer_uri = optional(string)
            identity_validation_expression = optional(string)
        })))
    })))
    authentication_type = optional(string)
    lambda_authorizer_config = optional(list(object({
        authorizer_result_ttl_in_seconds = optional(number)
        authorizer_uri = optional(string)
        identity_validation_expression = optional(string)
    })))
    log_config = optional(list(object({
        cloudwatch_logs_role_arn = optional(string)
        field_log_level = optional(string)
        exclude_verbose_content = optional(bool)
    })))
    name = optional(string)
    openid_connect_config = optional(list(object({
        auth_ttl = optional(number)
        client_id = optional(string)
        iat_ttl = optional(number)
        issuer = optional(string)
    })))
    schema = optional(string)
    tags = optional(map(string))
    user_pool_config = optional(list(object({
        app_id_client_regex = optional(string)
        aws_region = optional(string)
        default_action = optional(string)
        user_pool_id = optional(string)
    })))
    xray_enabled = optional(bool)
  })
}

resource "aws_appsync_graphql_api" "this" {

  {{- if $.Values.additional_authentication_provider }}
  dynamic "additional_authentication_provider" {
    for_each = var.values.additional_authentication_provider[*]
    content {
      authentication_type = additional_authentication_provider.value.authentication_type
      dynamic "openid_connect_config" {
        for_each = additional_authentication_provider.value.openid_connect_config[*]
        content {
          auth_ttl = openid_connect_config.value.auth_ttl
          client_id = openid_connect_config.value.client_id
          iat_ttl = openid_connect_config.value.iat_ttl
          issuer = openid_connect_config.value.issuer
        }
      }
      dynamic "user_pool_config" {
        for_each = additional_authentication_provider.value.user_pool_config[*]
        content {
          app_id_client_regex = user_pool_config.value.app_id_client_regex
          aws_region = user_pool_config.value.aws_region
          user_pool_id = user_pool_config.value.user_pool_id
        }
      }
      dynamic "lambda_authorizer_config" {
        for_each = additional_authentication_provider.value.lambda_authorizer_config[*]
        content {
          identity_validation_expression = lambda_authorizer_config.value.identity_validation_expression
          authorizer_result_ttl_in_seconds = lambda_authorizer_config.value.authorizer_result_ttl_in_seconds
          authorizer_uri = lambda_authorizer_config.value.authorizer_uri
        }
      }
    }
  }
  {{- end }}
  {{- if $.Values.authentication_type }}
  authentication_type = var.values.authentication_type
  {{- end }}
  {{- if $.Values.lambda_authorizer_config }}
  dynamic "lambda_authorizer_config" {
    for_each = var.values.lambda_authorizer_config[*]
    content {
      identity_validation_expression = lambda_authorizer_config.value.identity_validation_expression
      authorizer_result_ttl_in_seconds = lambda_authorizer_config.value.authorizer_result_ttl_in_seconds
      authorizer_uri = lambda_authorizer_config.value.authorizer_uri
    }
  }
  {{- end }}
  {{- if $.Values.log_config }}
  dynamic "log_config" {
    for_each = var.values.log_config[*]
    content {
      exclude_verbose_content = log_config.value.exclude_verbose_content
      cloudwatch_logs_role_arn = log_config.value.cloudwatch_logs_role_arn
      field_log_level = log_config.value.field_log_level
    }
  }
  {{- end }}
  {{- if $.Values.name }}
  name = var.values.name
  {{- end }}
  {{- if $.Values.openid_connect_config }}
  dynamic "openid_connect_config" {
    for_each = var.values.openid_connect_config[*]
    content {
      auth_ttl = openid_connect_config.value.auth_ttl
      client_id = openid_connect_config.value.client_id
      iat_ttl = openid_connect_config.value.iat_ttl
      issuer = openid_connect_config.value.issuer
    }
  }
  {{- end }}
  {{- if $.Values.schema }}
  schema = var.values.schema
  {{- end }}
  {{- if $.Values.tags }}
  tags = var.values.tags
  {{- end }}
  {{- if $.Values.user_pool_config }}
  dynamic "user_pool_config" {
    for_each = var.values.user_pool_config[*]
    content {
      aws_region = user_pool_config.value.aws_region
      default_action = user_pool_config.value.default_action
      user_pool_id = user_pool_config.value.user_pool_id
      app_id_client_regex = user_pool_config.value.app_id_client_regex
    }
  }
  {{- end }}
  {{- if $.Values.xray_enabled }}
  xray_enabled = var.values.xray_enabled
  {{- end }}


  {{- if $.Values.count }}
  count = {{ $.Values.count }}
  {{- end }}

  {{- if $.Values.lifecycle }}
  lifecycle {
    {{- if $.Values.lifecycle.create_before_destroy }}
    create_before_destroy = {{ $.Values.lifecycle.create_before_destroy }}
    {{- end }}
    {{- if $.Values.lifecycle.ignore_changes }}
    prevent_destroy = {{ $.Values.lifecycle.prevent_destroy }}
    {{- end }}
    {{- if $.Values.lifecycle.ignore_changes }}
    ignore_changes = {{ $.Values.lifecycle.ignore_changes }}
    {{- end }}
  }
  {{- end }}
}


output "arn" {
    value = aws_appsync_graphql_api.this.arn
}

